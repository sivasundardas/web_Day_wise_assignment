<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PMS – Cart & Checkout</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-semibold" href="user-dashboard.html">PMS</a>
    <ul class="navbar-nav ms-auto align-items-center gap-2">
      <li class="nav-item"><a class="nav-link" href="user-dashboard.html">Products</a></li>
      <li class="nav-item"><a class="nav-link active" href="cart.html">Checkout</a></li>
      <li class="nav-item"><button id="logoutBtn" class="btn btn-outline-danger btn-sm">Logout</button></li>
    </ul>
  </div>
</nav>

<div class="container py-4">
  <div id="guardMsg" class="my-2"></div>
  <div class="card p-3">
    <h4 class="mb-3">Your Cart</h4>
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr><th>#</th><th>Product</th><th>Price ($)</th><th></th></tr>
        </thead>
        <tbody id="tbody"></tbody>
        <tfoot>
          <tr>
            <th colspan="2" class="text-end">Total</th>
            <th id="total">$0</th>
            <th></th>
          </tr>
        </tfoot>
      </table>
    </div>
    <div class="d-flex justify-content-end gap-2">
      <a class="btn btn-outline-secondary" href="user-dashboard.html">Continue Shopping</a>
      <button class="btn btn-success" id="checkoutBtn">Place Order</button>
    </div>
    <div id="msg" class="mt-3"></div>
  </div>
</div>

<script>
function session(){ return JSON.parse(localStorage.getItem('pms_session')||'null'); }
function guard(){ const s=session(); if(!s){ location.href='login.html'; return false; } return true; }
function cartKey(){ const s=session(); return 'pms_cart_'+(s?s.id:'0'); }
function getCart(){ return JSON.parse(localStorage.getItem(cartKey())||'[]'); }
function saveCart(c){ localStorage.setItem(cartKey(), JSON.stringify(c)); }

const tbody = document.getElementById('tbody');
const totalEl = document.getElementById('total');
const msg = document.getElementById('msg');

document.getElementById('logoutBtn').onclick=()=>{ localStorage.removeItem('pms_session'); location.href='login.html'; };

function render(){
  const c = getCart();
  let total=0;
  tbody.innerHTML = c.map((item,i)=>{
    total+=Number(item.price||0);
    return `<tr>
      <td>${i+1}</td>
      <td>${item.name}</td>
      <td>$${item.price}</td>
      <td><button class="btn btn-sm btn-outline-danger" onclick="removeItem(${item.id})">Remove</button></td>
    </tr>`;
  }).join('') || `<tr><td colspan="4" class="text-center text-muted">Your cart is empty.</td></tr>`;
  totalEl.textContent = '$'+total.toFixed(2);
}

function removeItem(id){
  const c = getCart().filter(x=>x.id!==id);
  saveCart(c); render();
}

document.getElementById('checkoutBtn').onclick=()=>{
  if(getCart().length===0){ msg.innerHTML='<div class="alert alert-warning">Cart is empty.</div>'; return; }
  const orderNo = 'ORD'+Math.floor(Math.random()*1e6);
  saveCart([]); render();
  msg.innerHTML = `<div class="alert alert-success">✅ Order placed successfully. Your order no: <b>${orderNo}</b></div>`;
};

if(guard()) render();
</script>
</body>
</html>
